<div *ngIf="isDataLoaded">
  <div class="receiptcreate">
    <div class=" col-md-5 col-sm-12 col-xs-12">
      <div class="col-md-2 col-sm-12 col-xs-12">
        <label>{{'receipt-date'|translate}}</label>
      </div>
      <div class="col-md-10 col-sm-12 col-xs-12 date-div">
        <p-calendar dateFormat="dd.mm.yy" [(ngModel)]="receipt.purchaseDate" [showIcon]="true"></p-calendar>
      </div>
    </div>

    <div class="col-md-1 col-sm-0 col-xs-0">
      <div class="vertical-line"></div>
    </div>


    <div class=" col-md-6 col-sm-12 col-xs-12">
      <div class=" col-md-2 col-sm-12 col-xs-12">
        <label>{{'receipt-shop'|translate}}</label>
      </div>
      <div class=" col-md-8 col-sm-8 col-xs-8">
        <select  id="selectshop" class="form-control chosen-single-select" [(ngModel)]="receipt.shopID">
          <option *ngFor="let shop of shops" [value] = "shop.id">
            {{shop.name}}
          </option>
        </select>
      </div>
      <div class=" col-md-2 col-sm-4 col-xs-4">
        <button mat-raised-button type="button" id="addshopbutton" class="btn btn-success" (click)="showShopDialog()">
          <span class="glyphicon glyphicon-plus"></span>
        </button>
      </div>
    </div>

    <div class="col-md-12 col-sm-12 col-xs-12 hrDiv">
      <hr class="hrH">
    </div>

    <div class="tableheaders col-md-12 col-sm-12 col-xs-12">
      <div class="col-md-5 col-md-offset-1">
        <label>{{'receipt-name'|translate}}</label>
      </div>
      <div class="col-md-2">
        <label>{{'receipt-amount'|translate}}</label>
      </div>
      <div class="col-md-2">
        <label>{{'receipt-price'|translate}}</label>
      </div>
      <div class="col-md-2">
        <label>{{'receipt-total'|translate}}</label>
      </div>
    </div>

    <div class="col-md-12 col-sm-12 col-xs-12 hrDiv">
      <hr class="hrH">
    </div>

    <div class="receiptproducts col-md-12">
      <div class="productslinecreate" *ngFor="let product of receiptProducts; let i = index" [attr.data-index]="i">
        <div class="col-md-1 buttonproductcreate">
          <button (click)="deleteProduct(i)" class="btn btn-danger btn-xs" type="button" id="removeproductbutton"><small><span class="glyphicon glyphicon-remove"></span></small></button>
        </div>
        <div class="col-md-5 col-sm-3">
          {{product.productName}}
        </div>
        <div class="col-md-2 col-sm-3">
          <input pInputText  type="number" [(ngModel)]="product.amount" (keyup)="updateProductValues(product)" (change)="updateProductValues(product)">
        </div>
        <div class="col-md-2 col-sm-2">
          <input pInputText  type="number" [(ngModel)]="product.price" (keyup)="updateProductValues(product)"  (change)="updateProductValues(product)"> {{currency}}
        </div>
        <div class="col-md-2 col-sm-2">
          {{product.total}} {{currency}}
        </div>
      </div>
    </div>

    <div class="col-md-12 col-sm-12 hrDiv">
      <hr class="hrTotal">
    </div>

    <div class="productstotal col-md-12 col-sm-12">
      <div class="col-md-offset-9 col-md-1">
        <label>{{'receipt-total'|translate}}:</label>
      </div>
      <div class="col-md-2">
        <label>{{receipt.totalValue}} {{currency}}</label>
      </div>
    </div>

    <div class="receiptaddproduct">
      <button type="button" id="opendialogbutton" (click)="showProductDialog()" class="btn btn-success">{{'receipt-addproduct'|translate}}</button>
    </div>

    <div class="receiptbuttons">
      <a class="btn btn-danger" (click)="onCancel()">{{'common-cancel'|translate}}</a>
      <a class="btn btn-success" (click)="save()">{{'common-save'|translate}}</a>
    </div>
  </div>
</div>

<div *ngIf="!isDataLoaded">
  <mat-spinner></mat-spinner>
</div>

<p-dialog header="{{'receipt-addproduct'|translate}}" [(visible)]="productDialogDisplay" [width]="width" [height]="height" [draggable]="false" [modal]="true">
  <div class="createproductproduct" *ngIf="!newProduct">
    <label>{{'receipt-product'|translate}}:</label>
    <select class="forminput chosen-single-select"  [(ngModel)]="currentNewProduct.productId">
      <option *ngFor="let product of products" [value] = "product.id" >
        {{product.name}}
      </option>
    </select>
  </div>
  <div class="checkbox">
    <label><input id="newproductcheckbox" type="checkbox" (change)="newProduct = !newProduct"/> {{'receipt-newproduct'|translate}}</label>
  </div>
  <div id="newproduct" *ngIf="newProduct">
    <div class="createproductname">
      <label>{{'receipt-name'|translate}}:</label>
      <input class="forminput" placeholder="{{'receipt-name'|translate}}" [(ngModel)]="currentNewProduct.productName" />
    </div>
    <div class="createproductcategories">
      <label>{{'receipt-categories'|translate}}:</label>
      <p-multiSelect [options] = "multiSelectCategories" class="forminput chosen-group-select" multiple="multiple" [(ngModel)]="newProductCategories">

      </p-multiSelect>
    </div>
  </div>
  <div class="createproductamount">
    <label>{{'receipt-amount'|translate}}:</label>
    <input type="number" class="forminput" placeholder="{{'receipt-amount'|translate}}" [(ngModel)]="currentNewProduct.amount"/>
  </div>
  <div class="createproductprice">
    <label>{{'receipt-priceperunit'|translate}}:</label>
    <input type="number" class="forminput" placeholder="{{'receipt-priceperunit'|translate}}" [(ngModel)]="currentNewProduct.price"/>
  </div>
  <p-footer>
    <button type="button" pButton (click)="addProduct()" label="{{'common-add'|translate}}"></button>
    <button type="button" pButton (click)="productDialogDisplay=false" label="{{'common-cancel'|translate}}"></button>
  </p-footer>
</p-dialog>


<p-dialog header="{{'receipt-addshop'|translate}}" [(visible)]="shopDialogDisplay" [width]="width" [height]="height" [draggable]="false" [modal]="true">
  <label>{{'receipt-name'|translate}}:</label>
  <input type="text" #newShopName class="form-control" placeholder="{{'receipt-name'|translate}}"/>
  <p-footer>
    <button type="button" pButton (click)="addShop(newShopName)" label="{{'common-add'|translate}}"></button>
    <button type="button" pButton (click)="shopDialogDisplay=false" label="{{'common-cancel'|translate}}"></button>
  </p-footer>
</p-dialog>
